###############################################################################
# FILE: ae_map.ttl
# DESC: Stardog SMS Template file for mapping AE information to graph.
# REQ : File format requirements for both execution and consistent processing
#         by visualization scripts:
#         s line is hard left on line by itself
#         p,o line - indented at least one space.
#                  - ends in ; on same line, no trailing spaces
#         p : no short hand: 'rdf:type', not 'a'
#         File must end with carriage return on a line by itself.
# SRC :
# IN  : ae.csv , created by AE_imputeCSV.R
# OUT :
# NOTE: stardog-admin virtual import CTDasRDFSMS ae_map.TTL ae.csv
#  Export to TTL: stardog data export --format TURTLE CTDacd sRDFSMS C:/_github/CTDasRDF/data/source/EXPORT.ttl
#  Site information to be read in from a seperate source file (site seq, country id, etc.)
# TODO: AdminActivity Data cutoff preflabel needs to come from the data
###############################################################################
@prefix cd01p:        <https://w3id.org/phuse/cd01p#> .
@prefix cdiscpilot01: <https://w3id.org/phuse/cdiscpilot01#> .
@prefix code:         <https://w3id.org/phuse/code#> .
@prefix custom:       <https://w3id.org/phuse/custom#> .
@prefix rdfs:         <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sdtmterm:     <https://w3id.org/phuse/sdtmterm#> .
@prefix skos:         <http://www.w3.org/2004/02/skos/core#> .
@prefix study:        <https://w3id.org/phuse/study#> .
@prefix time:         <http://www.w3.org/2006/time#> .
@prefix xsd:          <http://www.w3.org/2001/XMLSchema#> .

# ---- section 1 -------------------------------------------------
# -----------------------------------------------------------------------------
# Person afflicted by AE 
cdiscpilot01:Person_{usubjid} 
  study:afflictedBy cdiscpilot01:AE{aeseq_im}_{aedecod_im} ;
.

# ---- Subtriples ----
#  Label will have wrong case until correctd 
cdiscpilot01:AE{aeseq_im}_{aedecod_im} 
  code:hasCode                       meddra:LLT{aellt_meddraN_im}_{aellt_meddraN_im};
  rdf:type                           study:AdverseEvent ;
  skos:prefLabel                     "AE{aeseq_im} {aedecod}"^^xsd:string ;
  study:actionTaken                  "{aeacn}" ;
  study:cancer                       sdtmterm:NoYesResponse_{aescan} ;
  study:causality                    code:Causality_{aerel_im_titleC} ;
  study:congenitalDefect             sdtmterm:NoYesResponse_{aescong} ;
  study:death                        sdtmterm:NoYesResponse_{aesdth} ;
  study:disabling                    sdtmterm:NoYesResponse_{aesdisab} ;
  study:endDay                       "{aeendy}"^^xsd:int ;
  study:groupID                      "{aeggrpid_im}" ;  
  study:hasCategory                  "{aecat_im}" ;
  study:hasDataCollectionDate        cdiscpilot01:Date_{aedtc} ;   # NEED TO ADD DATE TRIPLES
  study:hasInterval                  cdiscpilot01:Interval_{aestdtc}_{aeendtc} ;  # NEED INTERVAL TRIPLES!
  study:hasSubcategory               "{aescat_im}" ;  # hard coded?
  study:hospitalization              sdtmterm:NoYesResponse_{aeshosp} ;
  study:lifeThreatening              sdtmterm:NoYesResponse_{aeslife} ;
  study:modifiedTerm                 "{aedecod}" ; 
  study:overdose                     sdtmterm:NoYesResponse_{aesod} ;
  study:referenceID                  "REFID{aeseq_im}" ; 
  study:reportedTerm                 "{aedecod}" ;
  study:serious                      sdtmterm:NoYesResponse_{aeser} ;
  study:severity                     code:Severity_{aesev} ;
  study:sponsordefinedID             "{aespid}" ;
  study:startDay                     "{aestdy}"^^xsd:int ;

# QUESTIONS to AO OR TO RESEARCH IN THE DATA
#  code:outcome code:AEOutcome_NRNR ;# ??
#   # aeacn is NA for all obs.
#  study:actionTakenOther "N/A" ; # Source?
#  study:adverseEventPattern "SINGLE EVENT" ; # ?
#  study:concomitantTreatmentGiven sdtmterm:NoYesResponse_N ;  # ?

#  study:hasReferenceTimePointEndDate cdiscpilot01:Date_2012-07-07 ;  # where this date comes from?
#  
#  study:isPrespecified sdtmterm:NoYesResponse_N ;
#  study:medicallyImportantSeriousEvent sdtmterm:NoYesResponse_N ;
#  
#  
#  study:referencePeriodDay 64 ;
#  study:referenceTimePointDay 34 ;
#  study:relationshipToNonStudyDrug "NONE" ;
#  
#  study:seq "1"^^xsd:float ;

# ---- Subtriples ----
cdiscpilot01:Date_{aedtc} 
  rdf:type study:DataCollectionDate ;
  rdf:type study:FixedDoseIntervalEnd ;
  rdf:type study:VisitDate ;
  skos:prefLabel "{aedtc}" ;
  study:dateTimeInXSDString "{aedtc}" ;
.

cdiscpilot01:Interval_{aestdtc}_{aeendtc}
#DEL cdiscpilot01:Interval_2012-08-07_2012-08-30
  rdf:type study:AdverseEventInterval ;
  skos:prefLabel "Interval {aestdtc} to" ;
  time:hasBeginning cdiscpilot01:Date_{aestdtc} ;
  time:hasEnd cdiscpilot01:Date_{aeendtc} ;
.

cdiscpilot01:Date_{aestdtc}
  rdf:type study:AdverseEventBegin ;
  skos:prefLabel "{aestdtc}" ;
  study:dateTimeInXSDString "{aestdtc}" ;
.

cdiscpilot01:Date_{aeendtc} 
  rdf:type study:AdverseEventEnd ;
  skos:prefLabel "{aeendtc} " ;
  study:dateTimeInXSDString "{aeendtc} " ;
.

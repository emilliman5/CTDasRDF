###############################################################################
# FILE: VS_mappings.ttl
# DESC: Stardog SMS Template file for mapping VS to graph.
# REQ :
# SRC :
# IN  : CSV converted from VS.XPT, Subject 1015 only
# OUT :
# NOTE: stardog-admin virtual import CTDasRDF VS_mappings.TTL VS_subset.csv
#  Export to TTL: stardog data export --format TURTLE CTDasRDF C:/temp/test.ttl
#
#  Conventions:
#    Visit IRIs:
#      a) cdiscpilot01 : compressed form of original value in visit field: visit_im_titleCSh
#          Closer match to actual source data.
#      b) custom: and other external ont files: CamelCaseShortened: visit_im_CCaseSh to match
#          naming conventions in ontologies for classes, etc.
#  SDTM CODES:
# C67153.C25206_1  = TEMP
# C67153.C25208_1  =
# C67153.C25298_1  = SYSBP 1
# C67153.C25298_2  = SYSBP 2
# C67153.C25298_3  = SYSBP 3
# TODO:
###############################################################################

@prefix cd01p: <https://raw.githubusercontent.com/phuse-org/CTDasRDF/master/data/rdf/cdiscpilot01-protocol.ttl#> .
@prefix cdiscpilot01: <https://raw.githubusercontent.com/phuse-org/CTDasRDF/master/data/rdf/cdiscpilot01.ttl#> .
@prefix code: <https://raw.githubusercontent.com/phuse-org/CTDasRDF/master/data/rdf/code.ttl#> .
@prefix custom: <https://raw.githubusercontent.com/phuse-org/CTDasRDF/master/data/rdf/custom#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sdtmterm: <http://rdf.cdisc.org/sdtmterm#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix study: <https://raw.githubusercontent.com/phuse-org/CTDasRDF/master/data/rdf/study.ttl#> .
@prefix time: <http://www.w3.org/2006/time#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

cdiscpilot01:Person_{usubjid}
  study:participatesIn cdiscpilot01:Visit{visit_im_titleCSh}_{usubjid} ;
.

#---- Visit  EG: cdiscpilot01:VisitScreening1_01-701-1015 
#                EG:   study:hasSubActivity   AssumeBodyPositionSupine_SCREENING1_01-701-1015 
cdiscpilot01:Visit{visit_im_titleCSh}_{usubjid}
  rdf:type               custom:Visit{visit_im_titleCSh} ;
  study:activityStatus   code:ActivityStatus_{vsactstatus_im} ;
  study:hasPerformedDate cdiscpilot01:Date_{vsdtc_en} ;
  study:hasSubActivity   cdiscpilot01:AssumeBodyPosition{vspos_im_titleC}_{visit_im_comp}_{usubjid} ;
  study:hasSubActivity   cdiscpilot01:{vstestcd}_{usubjid}_{vsseq} ;
.

    # VisitDate - designate hasPerformedDate as a VisitDate
    cdiscpilot01:Date_{vsdtc_en}
      rdf:type   study:VisitDate ;
    .

    # AssumeBodyPosition   EG: "AssumeBodyPositionStanding_01-701-1015"
      cdiscpilot01:AssumeBodyPosition{vspos_im_titleC}_{visit_im_comp}_{usubjid}
       rdf:type             cdiscpilot01:Visit{visit_im_titleCSh}Activity_{usubjid};
       rdf:type             custom:AssumeBodyPosition{vspos_im_titleC}_{usubjid} ;
       skos:prefLabel       "Assume {vspos_im_titleC} position"^^xsd:string ;
       study:activityStatus code:ActivityStatus_{vsactstatus_im} ;
       study:hasDate        cdiscpilot01:Date_{vsdtc_en} ;
       study:hasStartRule   cdiscpilot01:{startRule_im}_{visit_im_comp}_{usubjid} ;
       study:outcome        code:Vspos_{vspos} ;
    .
    
        # Visit Activity
        cdiscpilot01:Visit{visit_im_titleCSh}Activity_{usubjid}
          rdf:type         owl:Class ;
          rdfs:subClassOf  custom:Visit{visit_im_titleCSh}Activity ;
          skos:prefLabel   "Visit {visit_im_titleC} Person {usubjid}"^^xsd:string ;
        .
        
        # Start Rule
        cdiscpilot01:{startRule_im}_{visit_im_comp}_{usubjid} 
            rdf:type              cd01p:{startRule_im} ;
            skos:prefLabel        "{usubjid} {visit_im_titleC} Rule {vstpt}"^^xsd:string ;
            study:hasPrerequisite cdiscpilot01:AssumeBodyPosition{vspos_im_titleC}_{visit_im_comp}_{usubjid} ;
        .
##    # Each vstestcd.  vsseq used to show relative sequence.
    cdiscpilot01:{vstestcd}_{usubjid}_{vsseq} 
      study:vstestcd         code:Vtestcd_{vstestcd} ;     
      rdf:type               cd01p:Visit{visit_im_titleCSh}{vstest_testtype_im} ;
      rdf:type               cdiscpilot01:Visit{visit_im_titleCSh}Activity_{usubjid} ;
      study:activityStatus   code:ActivityStatus_{vsactstatus_im} ;
      study:anatomicLocation code:Vsloc_{vsloc_im} ;
      study:baselineFlag     "{vsblfl}"^^xsd:string ;
      study:bodyPosition     code:Vspos_{vspos} ;
      study:derivedFlag      "{vsdrvfl_im}"^^xsd:string ;
      study:groupID          "{vsgrpid_im}"^^xsd:string ;
      study:hasCategory      cd01p:{vscat_im} ; 
      study:hasScheduledDate cdiscpilot01:Date_{vsdtc_en} ;
      study:hasStartRule     cdiscpilot01:{startRule_im}_{visit_im_comp}_{usubjid} ;
      study:hasSubcategory   cd01p:{vssubcat_im} ;
      study:laterality       code:Vslat_{vslat_im} ;
      study:outcome          cdiscpilot01:{vstestcd_im_titleC}Outcome_{vsorres_en} ;
      study:reasonNotDone    "{vsreasnotdone_im}"^^xsd:string ;
      study:seq              "{vsseq}"^^xsd:float ;
      study:sponsordefinedID "{vsspid_im}"^^xsd:string ;
    .
      # Test Outcome
        # cannot assign type (float/int etc) due to varying types in source column
        cdiscpilot01:{vstestcd_im_titleC}Outcome_{vsorres_en}
          code:hasUnit    code:Unit_{vsorresu} ;
          code:hasValue   "{vsorres}"^^xsd:string ;
          rdf:type        study:{vstestcd_im_titleC}Outcome ;
          skos:prefLabel "{vsorres} {vsorresu}"^^xsd:string ;
        .
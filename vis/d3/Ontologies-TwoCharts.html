<!DOCTYPE html>
<!-----------------------------------------------------------------------------
 $HeadURL: file:///C:/SVNLocalRepos/d3/Examples/flowers/FlowersHacking-FromSO.html $
 $Rev: 1058 $
 $Date: 2017-10-27 19:07:03 -0400 (Fri, 27 Oct 2017) $
 $Author: U041939 $
 -----------------------------------------------------------------------------
 DESCR: Hacking the original animated flowers
 SAUCE: http://bl.ocks.org/herrstucki/6199768/23f51b97bd942f6b1b7cf0b9ba76ada4cb6d1cc7
 VIEW : http://localhost:8000/d3/Examples/flowers/FlowersHacking.html
 INPUT:
 OUT  :
 NOTES:
TODO: :

------------------------------------------------------------------------------>
<meta charset="utf-8">
<head>
  <script type="text/javascript" src="/ctdasRDF/vis/d3/d3/d3.v3.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/ctdasRDF/vis/d3/css/CTDasRDF.css">
</head>  
<body>
<script>
var width = 500,
    height = 500,
    halfRadius = 100;  // length of petal & therefore size of digram overall

var size = d3.scale.sqrt()
  .domain([0, 1])
  .range([0, halfRadius]);

var extOntData = [
 {id:0, name:"BRIDG4-1-1",  src:"CDISC",  size:63263,  sizeLabel:"63263"  },
 {id:1, name:"SDTMIG3-1-3", src:"CDISC",  size:12266,  sizeLabel:"12266"  },
 {id:2, name:"SDTM-Term",   src:"CDISC",  size:198598, sizeLabel:"198598" },
 {id:3, name:"SDTM1-3",     src:"CDISC",  size:1778,   sizeLabel:"1778"   },
 {id:4, name:"OWL",         src:"W3C",    size:450,    sizeLabel:"450"   },
 {id:5, name:"RDF",         src:"W3C",    size:577,    sizeLabel:"102"    },
 {id:6, name:"RDFS",        src:"W3C",    size:577,    sizeLabel:"87"    },
 {id:7, name:"SKOS",        src:"W3C",    size:577,    sizeLabel:"252"    },
 {id:8, name:"Time",        src:"W3C",    size:577,    sizeLabel:"577"    },
 {id:9, name:"LOINC",       src:"Future", size:40000,  sizeLabel:"TBD" },
 {id:10, name:"MedDRA",      src:"Future", size:50000,  sizeLabel:"TBD"  },
 {id:11, name:"WHO-Drug",    src:"Future", size:50000,  sizeLabel:"TBD"  }
]
// NEW
var intOntData = [
 {id:0, name:"cdiscpilot01", src:"CDISC",  size:63263,  sizeLabel:"63263"  },
 {id:1, name:"study",        src:"CDISC",  size:12266,  sizeLabel:"12266"  },
 {id:2, name:"code",         src:"CDISC",  size:198598, sizeLabel:"198598" },
 {id:3, name:"protocol",     src:"CDISC",  size:1778,   sizeLabel:"1778"   }
]

var extOntScale = d3.scale.log()
  .domain([400,200000])
  .range([1,2]);

var intOntScale = d3.scale.log()
    .domain([400,200000])
    .range([1,2]);

var pie = d3.layout.pie()
  .sort(null)
  .value(function(d) { return extOntScale(d.size); });

//KLUDGES: Change to nested CSS Layouts
// div for title
var titlediv = d3.select("body").append("div")
  .append("text")
  .text("External Ontologies")
  .attr("class", 'smTitle');

var spacediv = d3.select("body").append("div")
  .append("text")
  .text(" ");
// Define the div for the petal tooltip
var div = d3.select("body").append("div")
  .attr("class", "extOntPetalTooltip")
  .style("opacity", 0);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width/2 + "," + height/2 + ")")
    ;

var svg2 = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
      .append("g")
        .attr("transform", "translate(" + width/2 + "," + height/2 + ")")
        ;


/* Important: Note use of d.data.src to get class name, as explained here:
  https://stackoverflow.com/questions/34821449/adding-class-names-to-arcs-from-data-in-d3-layout-pie
*/
var extOntPetal = svg.selectAll(".extOntPetal")
  .data(pie(extOntData))
  .enter().append("path")
    .attr("class", "extOntPetal")
    .attr("transform", function(d) { return r((d.startAngle + d.endAngle) / 2); })
    .attr("d", extOntPetalPath)
    .attr('class', function(d) {return ("extOntPetal " + d.data.src); })
    .on('mouseover', function(d){
      var extOntPetalSelection = d3.select(this).style({opacity:'0.8'});
        // d3.selectAll(".link").style("stroke","red").style("stroke-width",4);
      div.transition()
       .duration(200)
       .style("opacity", .9);
      div	.html("<b>"+d.data.name+"</b>"+ "<br/>" +
           "Source: " + d.data.src+"<br/>" +
           "Size (triples): "+ d.data.sizeLabel)
       .style("left", (d3.event.pageX) + "px")
       .style("top", (d3.event.pageY - 28) + "px");
    })
    //Mouseout Node  - bring node back to full colour
    .on('mouseout', function(d){
      var extOntPetalSelection= d3.select(this).style({opacity:'1.0',})
      div.transition()
        .duration(500)
        .style("opacity", 0);
     });

// Second Chart : Internal (int) files
var pie2 = d3.layout.pie()
  .sort(null)
  .value(function(d) { return intOntScale(d.size); });

var intOntPetal = svg.selectAll(".intOntPetal")
  .data(pie(intOntData))
  .enter().append("path")
    .attr("class", "intOntPetal")
    .attr("transform", function(d) { return r((d.startAngle + d.endAngle) / 2); })
    .attr("d", intOntPetalPath)
    .attr('class', function(d) {return ("intOntPetal " + d.data.src); })
    .on('mouseover', function(d){
       var intOntPetalSelection = d3.select(this).style({opacity:'0.8'});
         // d3.selectAll(".link").style("stroke","red").style("stroke-width",4);
       div.transition()
        .duration(200)
        .style("opacity", .9);
       div	.html("<b>"+d.data.name+"</b>"+ "<br/>" +
            "Source: " + d.data.src+"<br/>" +
            "Size (triples): "+ d.data.sizeLabel)
        .style("left", (d3.event.pageX) + "px")
        .style("top", (d3.event.pageY - 28) + "px");
    })
    //Mouseout Node  - bring node back to full colour
    .on('mouseout', function(d){
       var intOntPetalSelection= d3.select(this).style({opacity:'1.0',})
       div.transition()
         .duration(500)
         .style("opacity", 0);
    });

function extOntPetalPath(d) {
  var angle = (d.endAngle - d.startAngle) / 2,
      s = polarToCartesian(-angle, halfRadius),
      e = polarToCartesian(angle, halfRadius),
      // r = size(d.data.size),  // new here
      r = size(extOntScale(d.data.size)),  // new here
      m = {x: halfRadius + r, y: 0}, // increase from 0 to curve edges. Cool effect.
      c1 = {x: halfRadius + r / 2, y: s.y},
      c2 = {x: halfRadius + r / 2, y: e.y};
  //return "M0,0L" + s.x + "," + s.y + "Q" + c1.x + "," + c1.y + " " + m.x + "," + m.y + "L" + m.x + "," + m.y + "Q" + c2.x + "," + c2.y + " " + e.x + "," + e.y + "Z";
  return "M0,0L" + s.x + "," + s.y + "Q" + c1.x + "," + c1.y + " " + m.x + "," + m.y + "L" + m.x + "," + m.y + "Q" + c2.x + "," + c2.y + " " + e.x + "," + e.y + "Z";
};

function intOntPetalPath(d) {
  var angle = (d.endAngle - d.startAngle) / 2,
      s = polarToCartesian(-angle, halfRadius),
      e = polarToCartesian(angle, halfRadius),
      // r = size(d.data.size),  // new here
      r = size(intOntScale(d.data.size)),  // new here
      m = {x: halfRadius + r, y: 0},
      c1 = {x: halfRadius + r / 2, y: s.y},
      c2 = {x: halfRadius + r / 2, y: e.y};
  return "M0,0L" + s.x + "," + s.y + "Q" + c1.x + "," + c1.y + " " + m.x + "," + m.y + "L" + m.x + "," + m.y + "Q" + c2.x + "," + c2.y + " " + e.x + "," + e.y + "Z";
};



function r(angle) {
  return "rotate(" + (angle / Math.PI * 180) + ")";
}

function polarToCartesian(angle, radius) {
  return {
    x: Math.cos(angle) * radius,
    y: Math.sin(angle) * radius
  };
};

</script>
